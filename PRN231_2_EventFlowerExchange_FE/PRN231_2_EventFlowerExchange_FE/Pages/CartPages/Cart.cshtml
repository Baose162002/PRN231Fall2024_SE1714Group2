@page "/Cart"
@model PRN231_2_EventFlowerExchange_FE.Pages.CartPages.CartModel
@{
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart</title>
</head>
<body>
    <div x-data="cartManager()">
        <section class="container mx-auto px-4 py-6">
            <h2 class="text-3xl font-bold text-black mb-8">Your Cart</h2>

            <template x-if="cartItems.length > 0">
                <div>
                    <table class="w-full table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Product</th>
                                <th class="px-4 py-2">Quantity</th>
                                <th class="px-4 py-2">Price</th>
                                <th class="px-4 py-2">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="item in cartItems" :key="item.FlowerId">
                                <tr>
                                    <td class="border px-4 py-2" x-text="item.Name"></td>
                                    <td class="border px-4 py-2">
                                        <input type="number" x-model.number="item.Quantity" class="w-12 text-center" />
                                        <button x-on:click="updateQuantity(item.FlowerId, item.Quantity)"
                                                class="bg-indigo-600 text-white px-2 py-1 rounded-md hover:bg-indigo-700">
                                            Update
                                        </button>
                                    </td>
                                    <td class="border px-4 py-2" x-text="'$' + item.PricePerUnit"></td>
                                    <td class="border px-4 py-2" x-text="'$' + (item.PricePerUnit * item.Quantity)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>

                    <div class="mt-6">
                        <button x-on:click="placeOrder"
                                class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700">
                            Order
                        </button>
                    </div>
                </div>
            </template>

            <template x-if="cartItems.length === 0">
                <p>Your cart is empty.</p>
            </template>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script>
        function cartManager() {
            return {
                cartItems: [],
                init() {
                    const storedCart = this.getCookie('cartItems');
                    if (storedCart) {
                        this.cartItems = JSON.parse(storedCart);
                    }
                },
                updateQuantity(flowerId, quantity) {
                    const item = this.cartItems.find(item => item.FlowerId === flowerId);
                    if (item) {
                        item.Quantity = quantity;
                        this.updateCookie();
                    }
                },
                placeOrder() {
                    // Implement order placement logic here
                    alert('Order placed!');
                    this.cartItems = [];
                    this.updateCookie();
                },
                updateCookie() {
                    document.cookie = `cartItems=${JSON.stringify(this.cartItems)}; path=/; max-age=86400`;
                },
                getCookie(name) {
                    const value = `; ${document.cookie}`;
                    const parts = value.split(`; ${name}=`);
                    if (parts.length === 2) return parts.pop().split(';').shift();
                }
            }
        }
    </script>
</body>
</html>